<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - MindSight Elite 360</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        #login, #dashboard { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        form { display: flex; flex-direction: column; }
        label { margin: 10px 0 5px; }
        input, select, button { padding: 10px; margin-bottom: 10px; }
        #output { margin-top: 20px; padding: 10px; background: #e0f7fa; border: 1px solid #00acc1; }
        #deportistas { margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        .hidden { display: none; }
        button.edit-btn { background: #4CAF50; color: white; }
        button.update-btn { background: #2196F3; color: white; }
    </style>
</head>
<body>

    <div id="login">
        <h2>Login Admin</h2>
        <form id="loginForm">
            <label for="username">Usuario:</label>
            <input type="text" id="username" required>
            <label for="password">Contraseña:</label>
            <input type="password" id="password" required>
            <button type="submit">Ingresar</button>
        </form>
    </div>

    <div id="dashboard" class="hidden">
        <h2>Dashboard Admin - MindSight Elite 360</h2>
        
        <!-- Formulario para Datos de Deportista -->
        <h3>Agregar/Editar Deportista</h3>
        <form id="athleteForm">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" required>
            <label for="apellidos">Apellidos:</label>
            <input type="text" id="apellidos" required>
            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" required>
            <label for="mail">Email:</label>
            <input type="email" id="mail" required>
            <label for="deporte">Deporte:</label>
            <input type="text" id="deporte" required>
            <label for="fecha_nacimiento">Fecha de Nacimiento (YYYY-MM-DD):</label>
            <input type="date" id="fecha_nacimiento" required>
            <label for="hora_nacimiento">Hora de Nacimiento (HH:MM):</label>
            <input type="time" id="hora_nacimiento" required>
            <button type="submit" id="athleteSubmitBtn">Guardar Deportista</button>
        </form>

        <!-- Lista de Deportistas Guardados -->
        <h3>Deportistas Registrados</h3>
        <table id="athletesTable">
            <thead>
                <tr>
                    <th>Nombre Completo</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>Deporte</th>
                    <th>Fecha Nacimiento</th>
                    <th>Hora Nacimiento</th>
                    <th>Nº Análisis</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <button id="exportButton">Exportar Datos (CSV)</button>

        <!-- Formulario para Análisis de Objeto -->
        <h3>Análisis de Objeto</h3>
        <form id="analysisForm">
            <label for="deportistaSelect">Seleccionar Deportista:</label>
            <select id="deportistaSelect" required>
                <option value="">-- Elegir --</option>
            </select>
            <label for="objeto">Objeto:</label>
            <select id="objeto" required>
                <option value="espejo">Espejo</option>
                <option value="puerta">Puerta</option>
                <option value="reloj">Reloj</option>
                <option value="libro">Libro</option>
                <option value="rio">Río</option>
                <option value="vela">Vela</option>
                <option value="puente">Puente</option>
                <option value="llave">Llave</option>
                <option value="coche">Coche</option>
                <option value="casa">Casa</option>
            </select>
            <label for="estado">Estado:</label>
            <select id="estado" required>
                <!-- Opciones se llenan dinámicamente -->
            </select>
            <label for="color">Color:</label>
            <select id="color" required>
                <option value="dorado">Dorado</option>
                <option value="negro">Negro</option>
                <option value="blanco">Blanco</option>
                <option value="rojo">Rojo</option>
                <option value="azul">Azul</option>
                <option value="rosa">Rosa</option>
                <option value="violeta">Violeta</option>
            </select>
            <label for="textura">Textura:</label>
            <select id="textura" required>
                <option value="lisa">Lisa</option>
                <option value="aspera">Áspera</option>
                <option value="pegajosa">Pegajosa</option>
                <option value="fria">Fría</option>
                <option value="caliente">Caliente</option>
            </select>
            <label for="tamaño">Tamaño:</label>
            <select id="tamaño" required>
                <option value="pequeño">Pequeño</option>
                <option value="mediano">Mediano</option>
                <option value="grande">Grande</option>
            </select>
            <button type="submit">Analizar</button>
        </form>
        <div id="analysisOutput"></div>

        <button onclick="logout()">Cerrar Sesión</button>
    </div>

    <script>
        // Datos para análisis (completo para todos objetos)
        const objects = {
            "espejo": "Ego/Auto-percepción",
            "puerta": "Transiciones/Cambio",
            "reloj": "Relación con el Tiempo",
            "libro": "Infancia/Aprendizaje",
            "rio": "Emociones/Flujo",
            "vela": "Esperanza/Espiritualidad",
            "puente": "Relaciones/Conexiones",
            "llave": "Acceso/Secretos",
            "coche": "Autonomía/Independencia",
            "casa": "Familia/Hogar Interno"
        };

        const states = {
            "espejo": {
                "nuevo": ["Confianza en la autoimagen", "¿Qué te hace sentir seguro? Usa esa confianza."],
                "roto": ["Autoimagen dañada, trauma", "¿Qué dañó cómo te ves? Imagina reparar el espejo."],
                "sucio": ["Confusión sobre la identidad", "¿Qué te impide verte claro? Visualiza limpiar."],
                "antiguo": ["Apego al pasado", "¿Qué recuerdo define tu autoimagen? Reescribe."]
            },
            "puerta": {
                "abierta": ["Disposición al cambio", "¿Qué te motiva a avanzar? Usa esa energía."],
                "cerrada": ["Miedo al cambio, resistencia", "¿Qué te frena? Visualiza abrir la puerta."],
                "rota": ["Obstáculos en transiciones", "¿Qué bloqueó un cambio? Repara la puerta."],
                "sólida": ["Seguridad en decisiones", "¿Qué te da estabilidad? Usa esa fuerza."]
            },
            "reloj": {
                "funcionando": ["Control sobre el tiempo", "¿Qué te da control? Usa eso."],
                "parado": ["Estancamiento", "¿Qué te atrapó? Hazlo funcionar."],
                "roto": ["Ansiedad por el tiempo", "¿Qué rompió el tiempo? Repara el reloj."],
                "antiguo": ["Nostalgia", "¿Qué pasado revisitas? Imagina futuro."]
            },
            "libro": {
                "nuevo": ["Curiosidad infantil", "¿Qué te emociona aprender? Usa eso."],
                "desgastado": ["Experiencias vividas", "¿Qué recuerdos guardas?"],
                "páginas en blanco": ["Potencial, incertidumbre", "¿Qué escribes? Crea una historia."],
                "roto": ["Trauma infantil", "¿Qué se rompió en tu niñez? Reescribe."]
            },
            "rio": {
                "tranquilo": ["Paz emocional", "¿Qué te calma? Usa eso."],
                "turbulento": ["Conflictos emocionales", "¿Qué te abruma? Calma el río."],
                "seco": ["Agotamiento emocional", "¿Qué te dejó vacío? Llena el río."],
                "desbordado": ["Abrumado", "¿Qué te desborda? Estabiliza."]
            },
            "vela": {
                "encendida": ["Esperanza", "¿Qué te ilumina? Usa esa luz."],
                "apagada": ["Pérdida de motivación", "¿Qué apagó tu luz? Enciéndela."],
                "derritiéndose": ["Agotamiento", "¿Qué te consume? Protege la vela."],
                "intacta": ["Potencial", "¿Qué esperas para encender?"]
            },
            "puente": {
                "sólido": ["Conexiones fuertes", "¿Qué relaciones te sostienen?"],
                "inestable": ["Inseguridad en relaciones", "¿Qué relación es frágil? Repara."],
                "en construcción": ["Esfuerzo por conectar", "¿Qué construyes en relaciones?"],
                "antiguo": ["Vínculos pasados", "¿Qué vínculo pasado influye? Actualiza."]
            },
            "llave": {
                "nueva": ["Oportunidades", "¿Qué abres? Usa eso."],
                "oxidada": ["Bloqueos", "¿Qué te bloquea? Pule la llave."],
                "rota": ["Frustración", "¿Qué solución perdiste? Nueva llave."],
                "antigua": ["Secretos del pasado", "¿Qué secreto desbloqueas? Usa la llave."]
            },
            "coche": {
                "nuevo": ["Confianza", "¿A dónde te lleva tu autonomía?"],
                "averiado": ["Obstáculos", "¿Qué te frena? Repara el coche."],
                "viejo": ["Resiliencia", "¿Qué te dio fuerza? Imagina nuevo."],
                "sin combustible": ["Agotamiento", "¿Qué te dejó sin energía? Recarga."]
            },
            "casa": {
                "sólida": ["Seguridad", "¿Qué te da paz? Usa eso."],
                "en ruinas": ["Trauma familiar", "¿Qué se rompió en tu familia? Reconstruye."],
                "en construcción": ["Crecimiento", "¿Qué reconstruyes?"],
                "vacía": ["Soledad", "¿Qué ausencia sientes? Llena la casa."]
            }
        };

        const colors = {
            "dorado": ["Autoestima alta, éxito, valor", "¿Qué te hace sentir valioso? Visualiza brillar."],
            "negro": ["Aislamiento, misterio, introspección profunda", "¿Qué te hace sentir oscuro o aislado? Imagina añadir luz."],
            "blanco": ["Claridad, pureza, nuevo comienzo", "¿Qué te da paz o simplicidad? Reinicio del pasado."],
            "rojo": ["Pasión, urgencia, emociones intensas", "¿Qué te hace sentir intenso? Visualiza calmar."],
            "azul": ["Calma, estabilidad, serenidad", "¿Qué te da tranquilidad? Estabiliza."],
            "rosa": ["Amor propio, vulnerabilidad, necesidad de afecto", "¿Qué te hace sentir vulnerable? Añade afecto."],
            "violeta": ["Introspección, transformación, espiritualidad", "¿Qué te conecta con lo profundo? Transforma."]
        };

        const textures = {
            "lisa": ["Armonía, fluidez emocional, confianza restaurada", "¿Qué te hace sentir en paz? Suaviza la superficie."],
            "aspera": ["Conflictos internos, resistencia, heridas no sanadas", "¿Qué conflicto te irrita? Pule la aspereza."],
            "pegajosa": ["Apegos emocionales, emociones estancadas, codependencia", "¿Qué te mantiene atado? Limpia la pegajosidad."],
            "fria": ["Desconexión emocional, miedo, aislamiento", "¿Qué te hace sentir distante? Añade calor."],
            "caliente": ["Conexión emocional, pasión restaurada, vitalidad", "¿Qué te da energía vital? Infunde calor."]
        };

        const sizes = {
            "pequeño": ["Minimización, inseguridad, sentimiento de insignificancia", "¿Qué te hace sentir insuficiente? Visualiza agrandar."],
            "mediano": ["Equilibrio, estabilidad emocional, neutralidad", "¿Qué te mantiene en balance? Ajusta para dinamismo."],
            "grande": ["Abrumador, presión, importancia exagerada", "¿Qué te abruma? Visualiza reducir."]
        };

        // Login simple (cambia estos valores para producción)
        const adminUser = "admin";
        const adminPass = "clave";

        // Login Form
        document.getElementById("loginForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const user = document.getElementById("username").value;
            const pass = document.getElementById("password").value;
            if (user === adminUser && pass === adminPass) {
                document.getElementById("login").classList.add("hidden");
                document.getElementById("dashboard").classList.remove("hidden");
                loadAthletes();
                loadAthleteSelect();
            } else {
                alert("Usuario o contraseña incorrectos.");
            }
        });

        // Actualizar estados según objeto seleccionado
        document.getElementById("objeto").addEventListener("change", function() {
            const objeto = this.value;
            const estadoSelect = document.getElementById("estado");
            estadoSelect.innerHTML = "<option value=''>-- Elegir --</option>";
            if (states[objeto]) {
                Object.keys(states[objeto]).forEach(state => {
                    const option = document.createElement("option");
                    option.value = state;
                    option.text = state.charAt(0).toUpperCase() + state.slice(1);
                    estadoSelect.appendChild(option);
                });
            }
        });

        // Disparar cambio inicial para llenar estados del primer objeto
        document.getElementById("objeto").dispatchEvent(new Event("change"));

        // Logout
        function logout() {
            document.getElementById("dashboard").classList.add("hidden");
            document.getElementById("login").classList.remove("hidden");
        }

        // Athlete Form - Add or Edit
        let editingAthleteId = null;
        document.getElementById("athleteForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const athlete = {
                nombre: document.getElementById("nombre").value,
                apellidos: document.getElementById("apellidos").value,
                telefono: document.getElementById("telefono").value,
                mail: document.getElementById("mail").value,
                deporte: document.getElementById("deporte").value,
                fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
                hora_nacimiento: document.getElementById("hora_nacimiento").value,
                analyses: editingAthleteId ? (JSON.parse(localStorage.getItem("athletes"))[editingAthleteId].analyses || []) : []
            };
            let athletes = JSON.parse(localStorage.getItem("athletes")) || [];
            if (editingAthleteId !== null) {
                athletes[editingAthleteId] = athlete;
                document.getElementById("athleteSubmitBtn").textContent = "Guardar Deportista";
                editingAthleteId = null;
            } else {
                athletes.push(athlete);
            }
            localStorage.setItem("athletes", JSON.stringify(athletes));
            loadAthletes();
            loadAthleteSelect();
            document.getElementById("athleteForm").reset();
        });

        // Load Athletes Table with Edit Button
        function loadAthletes() {
            const tableBody = document.getElementById("athletesTable").querySelector("tbody");
            tableBody.innerHTML = "";
            let athletes = JSON.parse(localStorage.getItem("athletes")) || [];
            athletes.forEach((athlete, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${athlete.nombre} ${athlete.apellidos}</td>
                    <td>${athlete.telefono}</td>
                    <td>${athlete.mail}</td>
                    <td>${athlete.deporte}</td>
                    <td>${athlete.fecha_nacimiento}</td>
                    <td>${athlete.hora_nacimiento}</td>
                    <td>${athlete.analyses ? athlete.analyses.length : 0}</td>
                    <td><button class="edit-btn" onclick="editAthlete(${index})">Editar</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Edit Athlete
        function editAthlete(index) {
            let athletes = JSON.parse(localStorage.getItem("athletes")) || [];
            const athlete = athletes[index];
            document.getElementById("nombre").value = athlete.nombre;
            document.getElementById("apellidos").value = athlete.apellidos;
            document.getElementById("telefono").value = athlete.telefono;
            document.getElementById("mail").value = athlete.mail;
            document.getElementById("deporte").value = athlete.deporte;
            document.getElementById("fecha_nacimiento").value = athlete.fecha_nacimiento;
            document.getElementById("hora_nacimiento").value = athlete.hora_nacimiento;
            document.getElementById("athleteSubmitBtn").textContent = "Actualizar Deportista";
            editingAthleteId = index;
        }

        // Load Athlete Select for Analysis
        function loadAthleteSelect() {
            const select = document.getElementById("deportistaSelect");
            select.innerHTML = "<option value=''>-- Elegir Deportista --</option>";
            let athletes = JSON.parse(localStorage.getItem("athletes")) || [];
            athletes.forEach((athlete, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.text = `${athlete.nombre} ${athlete.apellidos} (${athlete.deporte})`;
                select.appendChild(option);
            });
        }

        // Analysis Form - Save to Athlete
        document.getElementById("analysisForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const athleteIndex = document.getElementById("deportistaSelect").value;
            if (athleteIndex === "") {
                alert("Selecciona un deportista para vincular el análisis.");
                return;
            }
            const obj = document.getElementById("objeto").value;
            const st = document.getElementById("estado").value;
            const col = document.getElementById("color").value;
            const tex = document.getElementById("textura").value;
            const siz = document.getElementById("tamaño").value;

            // Generate analysis (same as before)
            const psique = objects[obj] || "No encontrado";
            const stateData = states[obj] ? states[obj][st] : null;
            const stateInterp = stateData ? stateData[0] : "No encontrado";
            const stateGuide = stateData ? stateData[1] : "";
            const colorData = colors[col] || ["No encontrado", ""];
            const colorInterp = colorData[0];
            const colorGuide = colorData[1];
            const textureData = textures[tex] || ["No encontrado", ""];
            const textureInterp = textureData[0];
            const textureGuide = textureData[1];
            const sizeData = sizes[siz] || ["No encontrado", ""];
            const sizeInterp = sizeData[0];
            const sizeGuide = sizeData[1];

            const symbolism = `El ${obj} (${psique}) en estado ${st} (${stateInterp}) con color ${col} (${colorInterp}), textura ${tex} (${textureInterp}) y tamaño ${siz} (${sizeInterp}) simboliza una combinación de ${stateInterp.toLowerCase()} influenciada por ${colorInterp.toLowerCase()}, ${textureInterp.toLowerCase()} y ${sizeInterp.toLowerCase()}. Esto representa un trauma emocional relacionado con ${psique.toLowerCase()}.`;

            const trauma = `Posible trauma: ${stateInterp} agravado por ${colorInterp.toLowerCase()} (e.g., ${colorGuide.split('?')[0]}?), con sensación de ${textureInterp.toLowerCase()} (e.g., ${textureGuide.split('?')[0]}?) y percepción de ${sizeInterp.toLowerCase()} (e.g., ${sizeGuide.split('?')[0]}?). En la vida general, esto puede causar ${sizeInterp.toLowerCase()} en ${psique.toLowerCase()}, como inseguridad o abrumo. En deporte, afecta rendimiento por ${stateInterp.toLowerCase()} emocional, e.g., dudas en decisiones.`;

            const questions = `Preguntas para explorar: ${stateGuide} ${colorGuide} ${textureGuide} ${sizeGuide}`;

            const healing = `Cómo sanarlo: Libera con respiración cuadrada y gratitud al cuerpo. Re-visualiza el ${obj} en estado positivo (e.g., nuevo/intacto), color dorado (éxito), textura lisa/caliente (armonía/conexión), tamaño mediano (equilibrio), limpio, reluciente, con marco/orilla dorada reflejando victoria. Integra afirmaciones: 'Soy ${psique.toLowerCase()} equilibrado y poderoso'.`;

            // Save analysis to athlete
            let athletes = JSON.parse(localStorage.getItem("athletes")) || [];
            const analysis = {
                objeto: obj,
                estado: st,
                color: col,
                textura: tex,
                tamaño: siz,
                simbolismo: symbolism,
                trauma: trauma,
                preguntas: questions,
                sanacion: healing,
                fecha: new Date().toISOString().split('T')[0] // Fecha actual
            };
            athletes[athleteIndex].analyses = athletes[athleteIndex].analyses || [];
            athletes[athleteIndex].analyses.push(analysis);
            localStorage.setItem("athletes", JSON.stringify(athletes));
            loadAthletes(); // Actualiza tabla con nº análisis

            // Display result
            document.getElementById("analysisOutput").innerHTML = `
                <h4>Análisis Guardado para ${athletes[athleteIndex].nombre} ${athletes[athleteIndex].apellidos}:</h4>
                <p><strong>Representación/Simbolismo:</strong> ${symbolism}</p>
                <p><strong>Significado y Trauma:</strong> ${trauma}</p>
                <p><strong>Preguntas para Explorar:</strong> ${questions}</p>
                <p><strong>Cómo Sanarlo:</strong> ${healing}</p>
            `;
            document.getElementById("analysisForm").reset();
            document.getElementById("objeto").dispatchEvent(new Event("change"));
        });

        // Export CSV
        document.getElementById("exportButton").addEventListener("click", function() {
            let athletes = JSON.parse(localStorage.getItem("athletes")) || [];
            let csv = "Nombre,Apellidos,Telefono,Email,Deporte,Fecha Nacimiento,Hora Nacimiento,Objeto,Estado,Color,Textura,Tamaño,Simbolismo,Trauma,Preguntas,Sanacion,Fecha\n";
            athletes.forEach(athlete => {
                if (athlete.analyses && athlete.analyses.length > 0) {
                    athlete.analyses.forEach(analysis => {
                        csv += `"${athlete.nombre}","${athlete.apellidos}","${athlete.telefono}","${athlete.mail}","${athlete.deporte}","${athlete.fecha_nacimiento}","${athlete.hora_nacimiento}","${analysis.objeto}","${analysis.estado}","${analysis.color}","${analysis.textura}","${analysis.tamaño}","${analysis.simbolismo}","${analysis.trauma}","${analysis.preguntas}","${analysis.sanacion}","${analysis.fecha}"\n`;
                    });
                } else {
                    csv += `"${athlete.nombre}","${athlete.apellidos}","${athlete.telefono}","${athlete.mail}","${athlete.deporte}","${athlete.fecha_nacimiento}","${athlete.hora_nacimiento}","","","","","","","","","","\n`;
                }
            });
            const blob = new Blob([csv], { type: "text/csv" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "deportistas_con_analisis.csv";
            a.click();
        });
    </script>

</body>

</html>
