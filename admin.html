24
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - MindSight Elite 360</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        #login, #dashboard { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        form { display: flex; flex-direction: column; }
        label { margin: 10px 0 5px; }
        input, select, button, textarea { padding: 10px; margin-bottom: 10px; }
        #analysisOutput { margin-top: 20px; padding: 10px; background: #e0f7fa; border: 1px solid #00acc1; }
        #athletesTable, #analysesTable { margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f2f2f2; }
        .hidden { display: none !important; }
        button { background: #007cba; color: white; border: none; cursor: pointer; }
        button:hover { background: #005a87; }
        button.edit-btn, button.delete-btn, button.save-btn { padding: 5px; font-size: 12px; margin-right: 5px; }
        .edit-btn { background: #4CAF50; }
        .delete-btn { background: #f44336; }
        .save-btn { background: #2196F3; }
        input.edit-field, textarea { display: none; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="login">
        <h2>Login Admin</h2>
        <form id="loginForm">
            <label for="username">Usuario:</label>
            <input type="text" id="username" required>
            <label for="password">Contraseña:</label>
            <input type="password" id="password" required>
            <button type="submit">Ingresar</button>
        </form>
    </div>
    <div id="dashboard" class="hidden">
        <h2>Dashboard Admin - MindSight Elite 360</h2>
       
        <h3>Agregar Deportista</h3>
        <form id="athleteForm">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" required>
            <label for="apellidos">Apellidos:</label>
            <input type="text" id="apellidos" required>
            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" required>
            <label for="mail">Email:</label>
            <input type="email" id="mail" required>
            <label for="deporte">Deporte:</label>
            <input type="text" id="deporte" required>
            <label for="fecha_nacimiento">Fecha de Nacimiento (YYYY-MM-DD):</label>
            <input type="date" id="fecha_nacimiento" required>
            <label for="hora_nacimiento">Hora de Nacimiento (HH:MM):</label>
            <input type="time" id="hora_nacimiento" required>
            <button type="submit">Guardar Deportista</button>
        </form>

        <h3>Deportistas Registrados</h3>
        <table id="athletesTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellidos</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>Deporte</th>
                    <th>Fecha Nacimiento</th>
                    <th>Hora Nacimiento</th>
                    <th>Análisis</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <h3>Análisis de Objeto (Vinculado a Deportista)</h3>
        <form id="analysisForm">
            <label for="athleteIdForAnalysis">Seleccionar Deportista:</label>
            <select id="athleteIdForAnalysis" required>
                <option value="">-- Elegir --</option>
            </select>
            <label for="objeto">Objeto:</label>
            <select id="objeto" required>
                <option value="">-- Seleccionar --</option>
                <option value="espejo">Espejo</option>
                <option value="puerta">Puerta</option>
                <option value="reloj">Reloj</option>
                <option value="libro">Libro</option>
                <option value="rio">Río</option>
                <option value="vela">Vela</option>
                <option value="puente">Puente</option>
                <option value="llave">Llave</option>
                <option value="coche">Coche</option>
                <option value="casa">Casa</option>
            </select>
            <label for="estado">Estado:</label>
            <select id="estado" required>
                <option value="">-- Seleccionar --</option>
                <option value="roto">Roto</option>
                <option value="sucio">Sucio</option>
                <option value="limpio">Limpio</option>
                <option value="brillante">Brillante</option>
                <option value="oscuro">Oscuro</option>
                <option value="abierto">Abierto</option>
                <option value="cerrado">Cerrado</option>
                <option value="flotante">Flotante</option>
                <option value="hundido">Hundido</option>
                <option value="viejo">Viejo</option>
                <option value="nuevo">Nuevo</option>
                <option value="otro">Otro (especificar en notas)</option>
            </select>
            <label for="notas_estado">Notas (si seleccionaste "Otro" en estado):</label>
            <textarea id="notas_estado"></textarea>
            <label for="color">Color:</label>
            <select id="color" required>
                <option value="">-- Seleccionar --</option>
                <option value="dorado">Dorado</option>
                <option value="negro">Negro</option>
                <option value="blanco">Blanco</option>
                <option value="rojo">Rojo</option>
                <option value="azul">Azul</option>
                <option value="rosa">Rosa</option>
                <option value="violeta">Violeta</option>
                <option value="verde">Verde</option>
                <option value="amarillo">Amarillo</option>
                <option value="gris">Gris</option>
                <option value="naranja">Naranja</option>
                <option value="marron">Marrón</option>
            </select>
            <label for="textura">Textura:</label>
            <select id="textura" required>
                <option value="">-- Seleccionar --</option>
                <option value="lisa">Lisa</option>
                <option value="aspera">Áspera</option>
                <option value="pegajosa">Pegajosa</option>
                <option value="fria">Fría</option>
                <option value="caliente">Caliente</option>
                <option value="suave">Suave</option>
                <option value="dura">Dura</option>
                <option value="humeda">Húmeda</option>
                <option value="seca">Seca</option>
                <option value="brillante">Brillante</option>
                <option value="opaca">Opaca</option>
            </select>
            <label for="tamaño">Tamaño:</label>
            <select id="tamaño" required>
                <option value="">-- Seleccionar --</option>
                <option value="minusculo">Minúsculo</option>
                <option value="pequeño">Pequeño</option>
                <option value="mediano">Mediano</option>
                <option value="grande">Grande</option>
                <option value="gigante">Gigante</option>
            </select>
            <button type="submit">Analizar y Guardar</button>
        </form>
        <div id="analysisOutput"></div>

        <h3>Análisis por Deportista</h3>
        <select id="viewAthlete" onchange="loadAnalyses()">
            <option value="">-- Elegir Deportista --</option>
        </select>
        <table id="analysesTable" class="hidden">
            <thead>
                <tr>
                    <th>Objeto</th>
                    <th>Estado</th>
                    <th>Color</th>
                    <th>Textura</th>
                    <th>Tamaño</th>
                    <th>Simbolismo</th>
                    <th>Trauma</th>
                    <th>Fecha Análisis</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button onclick="exportData()">Exportar Datos (CSV)</button>
        <button onclick="logout()">Cerrar Sesión</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM cargado, iniciando configuración de login");
            
            // Login
            const adminUser = "admin";
            const adminPass = "mindsight123";
            const loginForm = document.getElementById("loginForm");
            const loginDiv = document.getElementById("login");
            const dashboardDiv = document.getElementById("dashboard");

            if (!loginForm) {
                console.error("Error: Elemento loginForm no encontrado");
                alert("Error crítico: Formulario de login no encontrado. Verifica el HTML.");
                return;
            }
            if (!loginDiv || !dashboardDiv) {
                console.error("Error: Elementos login o dashboard no encontrados", { loginDiv, dashboardDiv });
                alert("Error crítico: Elementos de interfaz no encontrados. Verifica el HTML.");
                return;
            }

            loginForm.addEventListener("submit", function(e) {
                e.preventDefault();
                console.log("Formulario de login enviado");
                const user = document.getElementById("username")?.value.trim();
                const pass = document.getElementById("password")?.value.trim();

                if (!user || !pass) {
                    console.error("Usuario o contraseña vacíos", { user, pass });
                    alert("Por favor, completa ambos campos.");
                    return;
                }

                console.log("Verificando credenciales", { user, pass });
                if (user === adminUser && pass === adminPass) {
                    console.log("Credenciales correctas, mostrando dashboard");
                    loginDiv.classList.add("hidden");
                    dashboardDiv.classList.remove("hidden");
                    loginForm.reset();
                    console.log("Cargando datos iniciales");
                    loadAthletes();
                    loadAthleteSelects();
                } else {
                    console.error("Credenciales incorrectas", { user, pass });
                    alert("Usuario o contraseña incorrectos. Usa: admin / mindsight123");
                }
            });

            function logout() {
                console.log("Cerrando sesión");
                dashboardDiv.classList.add("hidden");
                loginDiv.classList.remove("hidden");
                loginForm.reset();
            }

            // Resto del código (gestión de deportistas, análisis, etc.)
            const objects = {
                "espejo": "Ego/Auto-percepción (Arquetipo de la Sombra)",
                "puerta": "Transiciones/Cambio (Arquetipo del Umbral)",
                "reloj": "Relación con el Tiempo (Arquetipo del Viejo Sabio)",
                "libro": "Infancia/Aprendizaje (Arquetipo del Conocimiento)",
                "rio": "Emociones/Flujo (Arquetipo de la Gran Madre)",
                "vela": "Esperanza/Espiritualidad (Arquetipo de la Luz)",
                "puente": "Relaciones/Conexiones (Arquetipo de la Unión)",
                "llave": "Acceso/Secretos (Arquetipo de la Solución)",
                "coche": "Autonomía/Independencia (Arquetipo del Viaje)",
                "casa": "Familia/Hogar Interno (Arquetipo del Yo)"
            };
            const states = {
                "espejo": {
                    "roto": ["Fragmentación del yo", "Trauma por auto-rechazo o identidad rota.", "¿Qué parte de ti no quieres ver? ¿Qué rompió el espejo?", "Visualiza el espejo reparado, entero, reflejando tu yo completo con claridad."],
                    "sucio": ["Confusión interna", "Bloqueos que nublan la auto-percepción.", "¿Qué ensucia tu reflejo? ¿Qué necesitas limpiar?", "Visualiza el espejo limpio, pulido, mostrando tu verdad."],
                    "limpio": ["Claridad de conciencia", "Progreso en integrar la sombra.", "¿Qué ves claramente ahora? ¿Qué te empodera?", "Mantén el espejo limpio, reflejando tu fuerza interior."],
                    "brillante": ["Integración del yo", "Conexión con el inconsciente luminoso.", "¿Qué ilumina tu reflejo? ¿Qué te inspira?", "Visualiza el espejo brillando intensamente, amplificando tu luz interior."],
                    "oscuro": ["Sombra reprimida", "Miedo a enfrentar aspectos ocultos.", "¿Qué oculta la oscuridad? ¿Qué temes ver?", "Visualiza el espejo iluminado, revelando tu yo sin miedo."],
                    "abierto": ["Vulnerabilidad del yo", "Exposición excesiva de la psique.", "¿Qué expones al abrirte? ¿Qué necesitas proteger?", "Visualiza el espejo con un marco protector, reflejando solo lo esencial."],
                    "cerrado": ["Rechazo del yo", "Negación de la auto-observación.", "¿Por qué evitas mirarte? ¿Qué temes descubrir?", "Visualiza el espejo abierto, invitando a la auto-aceptación."],
                    "flotante": ["Desconexión del yo", "Evasión de la realidad interna.", "¿Por qué flota tu reflejo? ¿Qué evitas?", "Visualiza el espejo anclado, conectado a tu verdad."],
                    "hundido": ["Depresión del yo", "Peso emocional que oculta la autoimagen.", "¿Qué hunde tu reflejo? ¿Qué carga llevas?", "Visualiza el espejo emergiendo, claro y ligero."],
                    "viejo": ["Apego al pasado", "Traumas antiguos que definen la autoimagen.", "¿Qué recuerdos guarda el espejo? ¿Qué necesitas soltar?", "Visualiza el espejo renovado, reflejando un presente libre."],
                    "nuevo": ["Renovación del yo", "Oportunidad para redefinir la autoimagen.", "¿Qué nueva imagen ves? ¿Qué comienzas?", "Visualiza el espejo nuevo, reflejando un yo fortalecido."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el espejo según las notas, en un estado ideal de claridad."]
                },
                "puerta": {
                    "roto": ["Transiciones bloqueadas", "Miedo al cambio o trauma por oportunidades perdidas.", "¿Qué rompió la puerta? ¿Qué temes cruzar?", "Visualiza la puerta reparada, abriéndose a nuevas posibilidades."],
                    "sucio": ["Barreras emocionales", "Resistencia al cambio por acumulación de traumas.", "¿Qué ensucia la puerta? ¿Qué necesitas soltar?", "Visualiza la puerta limpia, lista para abrirse con facilidad."],
                    "limpio": ["Preparación para el cambio", "Progreso en aceptar transiciones.", "¿Qué te permite avanzar? ¿Qué está claro?", "Mantén la puerta limpia, lista para cruzar con confianza."],
                    "brillante": ["Oportunidad luminosa", "Apertura a nuevas fases de vida.", "¿Qué ilumina el camino? ¿Qué te motiva?", "Visualiza la puerta brillando, invitando a un futuro positivo."],
                    "oscuro": ["Miedo al cambio", "Trauma que oscurece las transiciones.", "¿Qué oscurece la puerta? ¿Qué temes?", "Visualiza la puerta iluminada, abriendo un camino claro."],
                    "abierto": ["Receptividad al cambio", "Oportunidad para explorar el inconsciente.", "¿Qué hay al otro lado? ¿Estás listo?", "Visualiza la puerta abierta, fluida y acogedora."],
                    "cerrado": ["Aislamiento defensivo", "Miedo a lo desconocido o trauma protector.", "¿Por qué está cerrada? ¿Qué protege?", "Visualiza la puerta abriéndose lentamente, con seguridad."],
                    "flotante": ["Desconexión de transiciones", "Evasión de decisiones importantes.", "¿Por qué flota la puerta? ¿Qué evitas decidir?", "Visualiza la puerta anclada, conectada a un camino firme."],
                    "hundido": ["Estancamiento en transiciones", "Peso que impide avanzar.", "¿Qué hunde la puerta? ¿Qué te retiene?", "Visualiza la puerta emergiendo, lista para abrirse."],
                    "viejo": ["Carga del pasado", "Transiciones bloqueadas por experiencias antiguas.", "¿Qué pasado guarda la puerta? ¿Qué necesitas soltar?", "Visualiza la puerta renovada, abriendo un presente libre."],
                    "nuevo": ["Renovación de oportunidades", "Inicio de una nueva fase.", "¿Qué abre esta puerta? ¿Qué comienzas?", "Visualiza la puerta nueva, abriendo un futuro brillante."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza la puerta según las notas, en un estado ideal de apertura."]
                },
                "reloj": {
                    "roto": ["Ansiedad temporal", "Trauma por pérdida de control del tiempo.", "¿Qué detuvo el reloj? ¿Qué tiempo temes?", "Visualiza el reloj reparado, marcando un ritmo tranquilo."],
                    "sucio": ["Confusión temporal", "Bloqueos que nublan la percepción del tiempo.", "¿Qué ensucia el reloj? ¿Qué necesitas aclarar?", "Visualiza el reloj limpio, funcionando con precisión."],
                    "limpio": ["Claridad temporal", "Progreso en aceptar el flujo del tiempo.", "¿Qué controlas ahora? ¿Qué te da paz?", "Mantén el reloj limpio, marcando un ritmo armónico."],
                    "brillante": ["Armonía con el tiempo", "Integración del ritmo vital.", "¿Qué ilumina el reloj? ¿Qué aceptas?", "Visualiza el reloj brillando, en perfecta sincronía."],
                    "oscuro": ["Miedo al tiempo", "Trauma por el paso inexorable del tiempo.", "¿Qué oscurece el reloj? ¿Qué temes perder?", "Visualiza el reloj iluminado, marcando un presente libre."],
                    "abierto": ["Exposición temporal", "Vulnerabilidad al ritmo de la vida.", "¿Qué expones en el tiempo? ¿Qué necesitas regular?", "Visualiza el reloj protegido, marcando un ritmo estable."],
                    "cerrado": ["Negación del tiempo", "Resistencia a aceptar el paso del tiempo.", "¿Por qué evitas el tiempo? ¿Qué temes?", "Visualiza el reloj abierto, funcionando con calma."],
                    "flotante": ["Desconexión temporal", "Evasión del presente.", "¿Por qué flota el reloj? ¿Qué evitas vivir?", "Visualiza el reloj anclado, marcando el ahora."],
                    "hundido": ["Depresión temporal", "Peso que estanca el flujo del tiempo.", "¿Qué hunde el reloj? ¿Qué carga llevas?", "Visualiza el reloj emergiendo, marcando un tiempo ligero."],
                    "viejo": ["Nostalgia dolorosa", "Traumas relacionados con el pasado.", "¿Qué pasado marca el reloj? ¿Qué necesitas soltar?", "Visualiza el reloj renovado, marcando un presente libre."],
                    "nuevo": ["Renovación temporal", "Oportunidad para un nuevo comienzo.", "¿Qué hora eliges? ¿Qué comienzas?", "Visualiza el reloj nuevo, marcando un futuro brillante."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el reloj según las notas, en un estado ideal de sincronía."]
                },
                "libro": {
                    "roto": ["Conocimiento fragmentado", "Trauma por secretos no resueltos.", "¿Qué páginas faltan? ¿Qué verdad evitas?", "Visualiza el libro reparado, con todas las respuestas claras."],
                    "sucio": ["Sabiduría nublada", "Confusión por creencias contaminadas.", "¿Qué ensucia las páginas? ¿Qué necesitas limpiar?", "Visualiza el libro limpio, con letras nítidas."],
                    "limpio": ["Acceso al conocimiento", "Progreso en aceptar verdades internas.", "¿Qué lees claramente? ¿Qué te empodera?", "Mantén el libro limpio, lleno de sabiduría clara."],
                    "brillante": ["Sabiduría iluminada", "Conexión con el inconsciente colectivo.", "¿Qué ilumina el libro? ¿Qué te inspira?", "Visualiza el libro brillando, revelando verdades profundas."],
                    "oscuro": ["Conocimiento reprimido", "Miedo a enfrentar verdades internas.", "¿Qué oculta el libro? ¿Qué temes leer?", "Visualiza el libro iluminado, con páginas claras."],
                    "abierto": ["Receptividad al aprendizaje", "Oportunidad para descubrir verdades.", "¿Qué lees? ¿Qué descubres?", "Visualiza el libro abierto, revelando conocimiento curativo."],
                    "cerrado": ["Bloqueo intelectual", "Resistencia a enfrentar verdades.", "¿Por qué está cerrado? ¿Qué temes leer?", "Visualiza el libro abriéndose, invitando a la comprensión."],
                    "flotante": ["Desconexión del conocimiento", "Evasión de verdades profundas.", "¿Por qué flota el libro? ¿Qué evitas aprender?", "Visualiza el libro anclado, accesible y claro."],
                    "hundido": ["Sabiduría abrumada", "Peso que oculta el aprendizaje.", "¿Qué hunde el libro? ¿Qué carga llevas?", "Visualiza el libro emergiendo, lleno de claridad."],
                    "viejo": ["Apego al pasado", "Traumas que limitan el aprendizaje.", "¿Qué historias guarda el libro? ¿Qué necesitas soltar?", "Visualiza el libro renovado, con páginas frescas."],
                    "nuevo": ["Renovación del aprendizaje", "Oportunidad para nuevas verdades.", "¿Qué escribes en el libro? ¿Qué comienzas?", "Visualiza el libro nuevo, lleno de posibilidades."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el libro según las notas, en un estado ideal de claridad."]
                },
                "rio": {
                    "roto": ["Emociones fragmentadas", "Trauma por rupturas emocionales.", "¿Qué rompió el flujo? ¿Qué necesitas unir?", "Visualiza el río unido, fluyendo suavemente."],
                    "sucio": ["Emociones reprimidas", "Trauma por acumulación emocional.", "¿Qué contamina el río? ¿Qué necesitas soltar?", "Visualiza el río limpio, claro y fluido."],
                    "limpio": ["Paz emocional", "Progreso en liberar emociones.", "¿Qué te da calma? ¿Qué fluye libremente?", "Mantén el río limpio, fluyendo con paz."],
                    "brillante": ["Flujo vital", "Armonía emocional y renovación.", "¿Qué ilumina el río? ¿Qué te revitaliza?", "Visualiza el río brillando, lleno de vida."],
                    "oscuro": ["Emociones reprimidas", "Miedo a sentir profundamente.", "¿Qué oscurece el río? ¿Qué temes sentir?", "Visualiza el río iluminado, fluyendo con claridad."],
                    "abierto": ["Libertad emocional", "Receptividad a sentimientos profundos.", "¿Qué fluye libremente? ¿Qué aceptas?", "Visualiza el río abierto, llevando emociones positivas."],
                    "cerrado": ["Emociones bloqueadas", "Resistencia a sentir.", "¿Por qué está estancado? ¿Qué temes liberar?", "Visualiza el río abriéndose, fluyendo libremente."],
                    "flotante": ["Desconexión emocional", "Evasión de sentimientos profundos.", "¿Por qué flota el río? ¿Qué evitas sentir?", "Visualiza el río anclado, conectado a tus emociones."],
                    "hundido": ["Depresión emocional", "Peso que estanca el flujo.", "¿Qué hunde el río? ¿Qué carga llevas?", "Visualiza el río emergiendo, ligero y claro."],
                    "viejo": ["Emociones antiguas", "Traumas emocionales del pasado.", "¿Qué pasado guarda el río? ¿Qué necesitas soltar?", "Visualiza el río renovado, fluyendo en el presente."],
                    "nuevo": ["Renovación emocional", "Oportunidad para un nuevo flujo.", "¿Qué nuevas emociones fluyen? ¿Qué comienzas?", "Visualiza el río nuevo, fluyendo con energía."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el río según las notas, en un estado ideal de fluidez."]
                },
                "vela": {
                    "roto": ["Fragilidad espiritual", "Trauma por pérdida de fe o guía.", "¿Qué rompió la vela? ¿Qué temes perder?", "Visualiza la vela reparada, ardiendo con fuerza."],
                    "sucio": ["Espiritualidad nublada", "Confusión en la conexión interna.", "¿Qué ensucia la vela? ¿Qué necesitas limpiar?", "Visualiza la vela limpia, con una llama pura."],
                    "limpio": ["Claridad espiritual", "Progreso en encontrar guía interna.", "¿Qué ilumina la vela? ¿Qué te da paz?", "Mantén la vela limpia, ardiendo con calma."],
                    "brillante": ["Iluminación espiritual", "Conexión con el alma.", "¿Qué ves en la luz? ¿Qué te inspira?", "Visualiza la vela brillando intensamente, guiándote."],
                    "oscuro": ["Pérdida de esperanza", "Miedo a la oscuridad interna.", "¿Qué apagó la vela? ¿Qué temes?", "Visualiza la vela encendida, iluminando tu interior."],
                    "abierto": ["Vulnerabilidad espiritual", "Exposición de la fe interna.", "¿Qué expones con la luz? ¿Qué necesitas proteger?", "Visualiza la vela protegida, con una llama estable."],
                    "cerrado": ["Negación espiritual", "Resistencia a conectar con el alma.", "¿Por qué está apagada? ¿Qué temes sentir?", "Visualiza la vela encendida, conectando con tu espíritu."],
                    "flotante": ["Desconexión espiritual", "Evasión de la guía interna.", "¿Por qué flota la vela? ¿Qué evitas conectar?", "Visualiza la vela anclada, con una llama firme."],
                    "hundido": ["Depresión espiritual", "Peso que apaga la luz interna.", "¿Qué hunde la vela? ¿Qué carga llevas?", "Visualiza la vela emergiendo, ardiendo con claridad."],
                    "viejo": ["Fe agotada", "Traumas espirituales antiguos.", "¿Qué pasado guarda la vela? ¿Qué necesitas soltar?", "Visualiza la vela renovada, con una llama fresca."],
                    "nuevo": ["Renovación espiritual", "Oportunidad para una nueva luz.", "¿Qué enciende esta vela? ¿Qué comienzas?", "Visualiza la vela nueva, ardiendo con fuerza."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza la vela según las notas, en un estado ideal de luz."]
                },
                "puente": {
                    "roto": ["Relaciones fracturadas", "Trauma por conflictos no resueltos.", "¿Qué rompió el puente? ¿Qué separa?", "Visualiza el puente reparado, uniendo tus relaciones."],
                    "sucio": ["Conexiones nubladas", "Dificultad para conectar por traumas.", "¿Qué ensucia el puente? ¿Qué necesitas limpiar?", "Visualiza el puente limpio, facilitando conexiones."],
                    "limpio": ["Conexiones claras", "Progreso en fortalecer relaciones.", "¿Qué une el puente? ¿Qué te conecta?", "Mantén el puente limpio, sólido y accesible."],
                    "brillante": ["Relaciones luminosas", "Armonía en conexiones internas y externas.", "¿Qué ilumina el puente? ¿Qué te une?", "Visualiza el puente brillando, fortaleciendo lazos."],
                    "oscuro": ["Aislamiento relacional", "Miedo a conectar con otros.", "¿Qué oscurece el puente? ¿Qué temes unir?", "Visualiza el puente iluminado, conectando con claridad."],
                    "abierto": ["Conexión libre", "Receptividad a relaciones profundas.", "¿Qué une el puente? ¿Qué aceptas?", "Visualiza el puente abierto, facilitando conexiones."],
                    "cerrado": ["Aislamiento protector", "Miedo a conectar con el otro lado.", "¿Por qué está cerrado? ¿Qué temes cruzar?", "Visualiza el puente abriéndose, seguro para conectar."],
                    "flotante": ["Desconexión relacional", "Evasión de vínculos profundos.", "¿Por qué flota el puente? ¿Qué evitas conectar?", "Visualiza el puente anclada, uniendo con firmeza."],
                    "hundido": ["Colapso relacional", "Peso que impide conexiones.", "¿Qué hunde el puente? ¿Qué carga llevas?", "Visualiza el puente emergiendo, sólido y claro."],
                    "viejo": ["Relaciones antiguas", "Traumas en vínculos pasados.", "¿Qué pasado guarda el puente? ¿Qué necesitas soltar?", "Visualiza el puente renovado, conectando el presente."],
                    "nuevo": ["Renovación relacional", "Oportunidad para nuevos lazos.", "¿Qué une este puente? ¿Qué comienzas?", "Visualiza el puente nuevo, fortaleciendo conexiones."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el puente según las notas, en un estado ideal de unión."]
                },
                "llave": {
                    "roto": ["Frustración", "Pérdida de acceso a soluciones.", "¿Qué solución perdiste? ¿Qué necesitas recuperar?", "Visualiza una llave nueva, desbloqueando oportunidades."],
                    "sucio": ["Bloqueos", "Trauma por soluciones estancadas.", "¿Qué te bloquea? ¿Qué necesitas pulir?", "Visualiza la llave limpia, pulida, abriendo con facilidad."],
                    "limpio": ["Acceso claro", "Progreso en encontrar soluciones.", "¿Qué abre esta llave? ¿Qué te empodera?", "Mantén la llave limpia, lista para desbloquear."],
                    "brillante": ["Oportunidades luminosas", "Conexión con soluciones claras.", "¿Qué ilumina la llave? ¿Qué te inspira?", "Visualiza la llave brillando, abriendo caminos claros."],
                    "oscuro": ["Secretos ocultos", "Miedo a desbloquear verdades.", "¿Qué oculta la llave? ¿Qué temes abrir?", "Visualiza la llave iluminada, desbloqueando con confianza."],
                    "abierto": ["Acceso libre", "Receptividad a soluciones.", "¿Qué abre esta llave? ¿Qué aceptas?", "Visualiza la llave funcionando, abriendo puertas libremente."],
                    "cerrado": ["Bloqueo defensivo", "Resistencia a desbloquear.", "¿Por qué no abre? ¿Qué temes liberar?", "Visualiza la llave girando, abriendo con seguridad."],
                    "flotante": ["Desconexión de soluciones", "Evasión de respuestas claras.", "¿Por qué flota la llave? ¿Qué evitas desbloquear?", "Visualiza la llave anclada, lista para abrir."],
                    "hundido": ["Pérdida de acceso", "Peso que bloquea soluciones.", "¿Qué hunde la llave? ¿Qué carga llevas?", "Visualiza la llave emergiendo, lista para desbloquear."],
                    "viejo": ["Secretos antiguos", "Traumas que bloquean el acceso.", "¿Qué pasado guarda la llave? ¿Qué necesitas soltar?", "Visualiza la llave renovada, abriendo el presente."],
                    "nuevo": ["Oportunidades", "Oportunidad para nuevas soluciones.", "¿Qué abre esta llave? ¿Qué comienzas?", "Visualiza la llave nueva, desbloqueando un futuro brillante."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza la llave según las notas, en un estado ideal de acceso."]
                },
                "coche": {
                    "roto": ["Pérdida de control", "Trauma por estancamiento o accidentes.", "¿Qué rompió el coche? ¿A dónde no llegas?", "Visualiza el coche reparado, avanzando con confianza."],
                    "sucio": ["Desorden vital", "Confusión en el rumbo de vida.", "¿Qué ensucia el coche? ¿Qué necesitas limpiar?", "Visualiza el coche limpio, listo para el viaje."],
                    "limpio": ["Dirección clara", "Progreso en el control del rumbo.", "¿A dónde te lleva el coche? ¿Qué te empodera?", "Mantén el coche limpio, avanzando con claridad."],
                    "brillante": ["Autonomía luminosa", "Conexión con el viaje personal.", "¿Qué ilumina el coche? ¿Qué te impulsa?", "Visualiza el coche brillando, en ruta al éxito."],
                    "oscuro": ["Miedo al rumbo", "Trauma por pérdida de dirección.", "¿Qué oscurece el coche? ¿Qué temes?", "Visualiza el coche iluminado, avanzando con confianza."],
                    "abierto": ["Vulnerabilidad en el viaje", "Exposición excesiva en el rumbo.", "¿Qué expones en el viaje? ¿Qué necesitas proteger?", "Visualiza el coche protegido, avanzando con seguridad."],
                    "cerrado": ["Bloqueo del rumbo", "Resistencia a avanzar.", "¿Por qué está detenido? ¿Qué temes?", "Visualiza el coche abierto, listo para moverse."],
                    "flotante": ["Desconexión del rumbo", "Evasión del camino personal.", "¿Por qué flota el coche? ¿Qué evitas avanzar?", "Visualiza el coche anclada, en un camino firme."],
                    "hundido": ["Estancamiento vital", "Peso que impide avanzar.", "¿Qué hunde el coche? ¿Qué carga llevas?", "Visualiza el coche emergiendo, listo para avanzar."],
                    "viejo": ["Carga del pasado", "Traumas que frenan el rumbo.", "¿Qué pasado guarda el coche? ¿Qué necesitas soltar?", "Visualiza el coche renovado, avanzando en el presente."],
                    "nuevo": ["Renovación del rumbo", "Oportunidad para un nuevo camino.", "¿Qué abre esta puerta? ¿Qué comienzas?", "Visualiza el coche nuevo, avanzando con energía."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el coche según las notas, en un estado ideal de movimiento."]
                },
                "casa": {
                    "roto": ["Inestabilidad interna", "Trauma por inseguridad en el hogar o yo.", "¿Qué rompió la casa? ¿Qué te desestabiliza?", "Visualiza la casa reparada, fuerte y acogedora."],
                    "sucio": ["Carga emocional", "Traumas acumulados en el yo.", "¿Qué ensucia la casa? ¿Qué necesitas limpiar?", "Visualiza la casa limpia, como un santuario."],
                    "limpio": ["Seguridad interna", "Progreso en construir un yo sólido.", "¿Qué te da paz? ¿Qué te fortalece?", "Mantén la casa limpia, acogiendo tu fuerza interior."],
                    "brillante": ["Integración del yo", "Armonía interna y seguridad.", "¿Qué ilumina la casa? ¿Qué te fortalece?", "Visualiza la casa brillando, llena de paz."],
                    "oscuro": ["Aislamiento interno", "Miedo a conectar con el yo.", "¿Qué oscurece la casa? ¿Qué temes?", "Visualiza la casa iluminada, acogedora y clara."],
                    "abierto": ["Vulnerabilidad interna", "Exposición del yo a influencias externas.", "¿Qué expones en la casa? ¿Qué necesitas proteger?", "Visualiza la casa abierta, pero protegida, acogiendo positividad."],
                    "cerrado": ["Aislamiento protector", "Miedo a abrirte al mundo.", "¿Por qué está cerrada? ¿Qué temes?", "Visualiza la casa abriéndose, recibiendo energía positiva."],
                    "flotante": ["Desconexión del yo", "Evasión de la estabilidad interna.", "¿Por qué flota la casa? ¿Qué evitas anclar?", "Visualiza la casa anclada, sólida y segura."],
                    "hundido": ["Depresión interna", "Peso que colapsa el yo.", "¿Qué hunde la casa? ¿Qué carga llevas?", "Visualiza la casa emergiendo, fuerte y clara."],
                    "viejo": ["Carga familiar", "Traumas heredados del pasado.", "¿Qué pasado guarda la casa? ¿Qué necesitas soltar?", "Visualiza la casa renovada, acogiendo el presente."],
                    "nuevo": ["Renovación del yo", "Oportunidad para un nuevo hogar interno.", "¿Qué construyes en esta casa? ¿Qué comienzas?", "Visualiza la casa nueva, llena de paz y fuerza."],
                    "otro": ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza la casa según las notas, en un estado ideal de seguridad."]
                }
            };
            const colors = {
                "dorado": ["Divinidad, integración total", "¿Qué te hace sentir valioso? Visualiza brillar."],
                "negro": ["Sombra, misterio, introspección profunda", "¿Qué te hace sentir aislado? Imagina añadir luz."],
                "blanco": ["Pureza, claridad, nuevo comienzo", "¿Qué te da paz? Reinicia el pasado."],
                "rojo": ["Pasión, urgencia, emociones intensas", "¿Qué te hace sentir intenso? Visualiza calmar."],
                "azul": ["Calma, estabilidad, serenidad", "¿Qué te da tranquilidad? Estabiliza."],
                "rosa": ["Amor propio, vulnerabilidad, afecto", "¿Qué te hace sentir vulnerable? Añade afecto."],
                "violeta": ["Transformación, espiritualidad", "¿Qué te conecta con lo profundo? Transforma."],
                "verde": ["Crecimiento, conexión con la naturaleza", "¿Qué te hace crecer? Conecta con la vida."],
                "amarillo": ["Intuición, iluminación", "¿Qué te inspira? Visualiza claridad."],
                "gris": ["Neutralidad, ambigüedad", "¿Qué te confunde? Busca claridad."],
                "naranja": ["Creatividad, entusiasmo", "¿Qué te energiza? Amplifica esa energía."],
                "marron": ["Estabilidad, raíces terrenales", "¿Qué te ancla? Fortalece tus raíces."]
            };
            const textures = {
                "lisa": ["Armonía, fluidez emocional", "¿Qué te hace sentir en paz? Suaviza la superficie."],
                "aspera": ["Conflictos internos, heridas no sanadas", "¿Qué conflicto te irrita? Pule la aspereza."],
                "pegajosa": ["Apegos emocionales, codependencia", "¿Qué te mantiene atado? Limpia la pegajosidad."],
                "fria": ["Desconexión emocional, aislamiento", "¿Qué te hace sentir distante? Añade calor."],
                "caliente": ["Pasión restaurada, vitalidad", "¿Qué te da energía vital? Infunde calor."],
                "suave": ["Receptividad, calma", "¿Qué te calma? Mantén la suavidad."],
                "dura": ["Rigidez defensiva", "¿Qué te endurece? Suaviza tu interior."],
                "humeda": ["Emociones fluidas", "¿Qué emociones fluyen? Acepta el flujo."],
                "seca": ["Aridez espiritual", "¿Qué te dejó seco? Hidrata tu alma."],
                "brillante": ["Claridad, energía", "¿Qué te ilumina? Amplifica la luz."],
                "opaca": ["Confusión, bloqueo", "¿Qué te nubla? Busca claridad."]
            };
            const sizes = {
                "minusculo": ["Insignificancia, inseguridad", "¿Qué te hace sentir pequeño? Visualiza agrandar."],
                "pequeño": ["Minimización, modestia", "¿Qué minimizas? Ajusta la perspectiva."],
                "mediano": ["Equilibrio, estabilidad", "¿Qué te mantiene en balance? Mantén el equilibrio."],
                "grande": ["Abrumador, ego inflado", "¿Qué te abruma? Visualiza reducir."],
                "gigante": ["Amenaza amplificada", "¿Qué te parece inmenso? Redimensiona."]
            };
            const tips = [
                "Agradecimiento al cuerpo: Dedica 2-3 min diarios a agradecer a tu corazón, pulmones, etc., diciendo: 'Gracias por sostenerme'. Visualiza gratitud para sanar.",
                "Manifestación en presente: Repite 2 min al día afirmaciones como 'Soy paz'. Siente que ya es real para reprogramar creencias.",
                "Respiración cuadrada: Inhala 4 seg, reten 4, exhala 4, reten 4. Repite 5-10 veces (3-5 min) visualizando disolver tensiones.",
                "Visualización de luz sanadora: Visualiza 3-5 min luz dorada entrando por tu coronilla, disolviendo dolores emocionales como niebla al sol.",
                "Afirmaciones con espejo: Mírate al espejo 1-2 min, di 'Soy amor, soy luz'. Siente las palabras resonar para sanar autoestima.",
                "Respiración chamánica: Inhala 4 seg, reten 4, exhala 4, libera humo negro. Repite 10 veces (2-3 min) para limpiar energías estancadas.",
                "Diario de gratitud: Escribe 5 min cada noche 3 gratitudes y una herida a liberar, visualizándola como flor que crece.",
                "Visualización de guías: Dedica 3-5 min a imaginar un guía (animal, luz) que te ayuda a sanar. Pregunta: '¿Qué necesito liberar?'.",
                "Manifestación con agua: Infunde un vaso de agua con 'Esta agua limpia mis heridas' (2 min). Bébelo visualizando purificación.",
                "Círculo de luz: Visualiza 3-5 min un círculo de luz protectora, diciendo: 'Estoy sanado, estoy completo' para integrar sanación."
            ];

            // Llenar selects para análisis y visualización
            function loadAthleteSelects() {
                console.log("Cargando selects de deportistas");
                const athletes = getAthletes();
                const analysisSelect = document.getElementById("athleteIdForAnalysis");
                const viewSelect = document.getElementById("viewAthlete");
                if (analysisSelect && viewSelect) {
                    analysisSelect.innerHTML = "<option value=''>-- Elegir --</option>";
                    viewSelect.innerHTML = "<option value=''>-- Elegir Deportista --</option>";
                    athletes.forEach(athlete => {
                        const optionAnalysis = document.createElement("option");
                        optionAnalysis.value = athlete.id;
                        optionAnalysis.text = `${athlete.nombre} ${athlete.apellidos}`;
                        analysisSelect.appendChild(optionAnalysis);
                        const optionView = document.createElement("option");
                        optionView.value = athlete.id;
                        optionView.text = `${athlete.nombre} ${athlete.apellidos}`;
                        viewSelect.appendChild(optionView);
                    });
                } else {
                    console.error("Selects de deportistas no encontrados");
                }
            }

            // Obtener deportistas
            function getAthletes() {
                return JSON.parse(localStorage.getItem("athletes")) || [];
            }

            // Guardar deportista
            const athleteForm = document.getElementById("athleteForm");
            if (athleteForm) {
                athleteForm.addEventListener("submit", function(e) {
                    e.preventDefault();
                    console.log("Guardando deportista");
                    const athlete = {
                        id: Date.now().toString(),
                        nombre: document.getElementById("nombre").value,
                        apellidos: document.getElementById("apellidos").value,
                        telefono: document.getElementById("telefono").value,
                        mail: document.getElementById("mail").value,
                        deporte: document.getElementById("deporte").value,
                        fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
                        hora_nacimiento: document.getElementById("hora_nacimiento").value,
                        analyses: []
                    };
                    let athletes = getAthletes();
                    athletes.push(athlete);
                    localStorage.setItem("athletes", JSON.stringify(athletes));
                    loadAthletes();
                    loadAthleteSelects();
                    athleteForm.reset();
                    alert("Deportista guardado.");
                });
            } else {
                console.error("Elemento athleteForm no encontrado.");
            }

            // Cargar tabla deportistas con edición inline
            function loadAthletes() {
                console.log("Cargando tabla de deportistas");
                const tableBody = document.getElementById("athletesTable")?.querySelector("tbody");
                if (!tableBody) {
                    console.error("Tabla de deportistas no encontrada");
                    return;
                }
                tableBody.innerHTML = "";
                const athletes = getAthletes();
                athletes.forEach(athlete => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${athlete.id}</td>
                        <td>
                            <span class="display">${athlete.nombre}</span>
                            <input type="text" class="edit-field" id="edit-nombre-${athlete.id}" value="${athlete.nombre}">
                        </td>
                        <td>
                            <span class="display">${athlete.apellidos}</span>
                            <input type="text" class="edit-field" id="edit-apellidos-${athlete.id}" value="${athlete.apellidos}">
                        </td>
                        <td>
                            <span class="display">${athlete.telefono}</span>
                            <input type="tel" class="edit-field" id="edit-telefono-${athlete.id}" value="${athlete.telefono}">
                        </td>
                        <td>
                            <span class="display">${athlete.mail}</span>
                            <input type="email" class="edit-field" id="edit-mail-${athlete.id}" value="${athlete.mail}">
                        </td>
                        <td>
                            <span class="display">${athlete.deporte}</span>
                            <input type="text" class="edit-field" id="edit-deporte-${athlete.id}" value="${athlete.deporte}">
                        </td>
                        <td>
                            <span class="display">${athlete.fecha_nacimiento}</span>
                            <input type="date" class="edit-field" id="edit-fecha_nacimiento-${athlete.id}" value="${athlete.fecha_nacimiento}">
                        </td>
                        <td>
                            <span class="display">${athlete.hora_nacimiento}</span>
                            <input type="time" class="edit-field" id="edit-hora_nacimiento-${athlete.id}" value="${athlete.hora_nacimiento}">
                        </td>
                        <td>${athlete.analyses.length}</td>
                        <td>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'nombre')">✏️</button>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'apellidos')">✏️</button>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'telefono')">✏️</button>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'mail')">✏️</button>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'deporte')">✏️</button>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'fecha_nacimiento')">✏️</button>
                            <button class="edit-btn" onclick="toggleEdit('${athlete.id}', 'hora_nacimiento')">✏️</button>
                            <button class="save-btn hidden" id="save-${athlete.id}" onclick="saveEdit('${athlete.id}')">Guardar</button>
                            <button class="delete-btn" onclick="deleteAthlete('${athlete.id}')">🗑️</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Edición inline
            function toggleEdit(id, field) {
                console.log(`Editando campo ${field} para ID ${id}`);
                const display = document.querySelector(`#athletesTable tr td:nth-child(${field === 'nombre' ? 2 : field === 'apellidos' ? 3 : field === 'telefono' ? 4 : field === 'mail' ? 5 : field === 'deporte' ? 6 : field === 'fecha_nacimiento' ? 7 : 8}) .display`);
                const input = document.getElementById(`edit-${field}-${id}`);
                const saveBtn = document.getElementById(`save-${id}`);
                if (display && input && saveBtn) {
                    display.style.display = display.style.display === 'none' ? 'inline' : 'none';
                    input.style.display = input.style.display === 'none' ? 'inline' : 'none';
                    saveBtn.classList.toggle('hidden');
                } else {
                    console.error("Elementos para edición no encontrados", { display, input, saveBtn });
                }
            }

            function saveEdit(id) {
                console.log(`Guardando edición para ID ${id}`);
                const athletes = getAthletes();
                const athlete = athletes.find(a => a.id === id);
                if (athlete) {
                    athlete.nombre = document.getElementById(`edit-nombre-${id}`).value || athlete.nombre;
                    athlete.apellidos = document.getElementById(`edit-apellidos-${id}`).value || athlete.apellidos;
                    athlete.telefono = document.getElementById(`edit-telefono-${id}`).value || athlete.telefono;
                    athlete.mail = document.getElementById(`edit-mail-${id}`).value || athlete.mail;
                    athlete.deporte = document.getElementById(`edit-deporte-${id}`).value || athlete.deporte;
                    athlete.fecha_nacimiento = document.getElementById(`edit-fecha_nacimiento-${id}`).value || athlete.fecha_nacimiento;
                    athlete.hora_nacimiento = document.getElementById(`edit-hora_nacimiento-${id}`).value || athlete.hora_nacimiento;
                    localStorage.setItem("athletes", JSON.stringify(athletes));
                    loadAthletes();
                    loadAthleteSelects();
                    alert("Deportista actualizado.");
                }
            }

            // Eliminar deportista
            function deleteAthlete(id) {
                console.log(`Eliminando deportista ID ${id}`);
                if (confirm("¿Estás seguro de que quieres eliminar este deportista y todos sus análisis?")) {
                    let athletes = getAthletes();
                    athletes = athletes.filter(a => a.id !== id);
                    localStorage.setItem("athletes", JSON.stringify(athletes));
                    loadAthletes();
                    loadAthleteSelects();
                    alert("Deportista eliminado.");
                }
            }

            // Análisis de objeto
            const analysisForm = document.getElementById("analysisForm");
            if (analysisForm) {
                analysisForm.addEventListener("submit", function(e) {
                    e.preventDefault();
                    console.log("Formulario de análisis enviado");
                    const athleteId = document.getElementById("athleteIdForAnalysis").value;
                    if (!athleteId) {
                        console.error("Deportista no seleccionado");
                        alert("Selecciona un deportista.");
                        return;
                    }
                    const obj = document.getElementById("objeto").value;
                    const st = document.getElementById("estado").value;
                    const col = document.getElementById("color").value;
                    const tex = document.getElementById("textura").value;
                    const siz = document.getElementById("tamaño").value;
                    const notas = document.getElementById("notas_estado").value;
                    if (!obj || !st || !col || !tex || !siz) {
                        console.error("Campos de análisis incompletos", { obj, st, col, tex, siz });
                        alert("Completa todos los campos del análisis.");
                        return;
                    }
                    if (st === "otro" && !notas) {
                        console.error("Notas requeridas para estado 'otro'");
                        alert("Especifica notas para el estado 'Otro'.");
                        return;
                    }
                    // Generar análisis
                    const psique = objects[obj] || "No encontrado";
                    const stateData = states[obj] && states[obj][st] ? states[obj][st] : ["Definido por notas", "Trauma personalizado.", "Especifica en notas qué simboliza este estado.", "Visualiza el objeto según las notas, en un estado ideal."];
                    const stateInterp = stateData[0];
                    const stateTrauma = stateData[1];
                    const stateQuestions = stateData[2];
                    const stateHealing = stateData[3];
                    const colorData = colors[col] || ["No encontrado", ""];
                    const colorInterp = colorData[0];
                    const colorQuestions = colorData[1];
                    const textureData = textures[tex] || ["No encontrado", ""];
                    const textureInterp = textureData[0];
                    const textureQuestions = textureData[1];
                    const sizeData = sizes[siz] || ["No encontrado", ""];
                    const sizeInterp = sizeData[0];
                    const sizeQuestions = sizeData[1];
                    const symbolism = `El ${obj} (${psique}) en estado ${st}${notas ? ` (${notas})` : ""} simboliza ${stateInterp.toLowerCase()}, influenciado por el color ${col} (${colorInterp.toLowerCase()}), la textura ${tex} (${textureInterp.toLowerCase()}) y el tamaño ${siz} (${sizeInterp.toLowerCase()}). Representa un aspecto de ${psique.toLowerCase()} en el inconsciente.`;
                    const trauma = `Posible trauma: ${stateTrauma} Modificado por ${colorInterp.toLowerCase()} (e.g., ${colorQuestions.split('?')[0]}?), con sensación de ${textureInterp.toLowerCase()} (e.g., ${textureQuestions.split('?')[0]}?) y percepción de ${sizeInterp.toLowerCase()} (e.g., ${sizeQuestions.split('?')[0]}?). En la vida, esto puede manifestarse como ${stateInterp.toLowerCase()} en ${psique.toLowerCase()}. En el deporte, afecta el rendimiento por ${stateTrauma.toLowerCase()}.`;
                    const questions = `Preguntas para explorar: ${stateQuestions} ${colorQuestions} ${textureQuestions} ${sizeQuestions}${notas ? ` ¿Cómo describe las notas este estado?` : ""}`;
                    const healing = notas && st === "otro" ? `Visualiza el ${obj} según las notas: ${notas}, en un estado ideal (limpio, entero, brillante, equilibrado).` : stateHealing;
                    // Asignar tip
                    const athletes = getAthletes();
                    const athleteIndex = athletes.findIndex(a => a.id === athleteId);
                    const tipIndex = athleteIndex !== -1 && athletes[athleteIndex].analyses ? athletes[athleteIndex].analyses.length % 10 : 0;
                    const tip = tips[tipIndex];
                    // Guardar análisis
                    if (athleteIndex !== -1) {
                        const analysis = {
                            objeto: obj,
                            estado: st,
                            color: col,
                            textura: tex,
                            tamaño: siz,
                            notas: notas,
                            simbolismo: symbolism,
                            trauma: trauma,
                            preguntas: questions,
                            sanacion: healing,
                            tip: tip,
                            fecha: new Date().toISOString()
                        };
                        athletes[athleteIndex].analyses.push(analysis);
                        localStorage.setItem("athletes", JSON.stringify(athletes));
                        loadAthletes();
                        loadAthleteSelects();
                        alert("Análisis guardado para el deportista.");
                    } else {
                        console.error("Deportista no encontrado para ID", athleteId);
                        alert("Error: Deportista no encontrado.");
                        return;
                    }
                    // Mostrar resultado
                    document.getElementById("analysisOutput").innerHTML = `
                        <h4>Análisis Guardado para ${athletes[athleteIndex].nombre} ${athletes[athleteIndex].apellidos}:</h4>
                        <p><strong>Representación/Simbolismo:</strong> ${symbolism}</p>
                        <p><strong>Significado y Trauma:</strong> ${trauma}</p>
                        <p><strong>Preguntas para Explorar:</strong> ${questions}</p>
                        <p><strong>Cómo Sanarlo:</strong> ${healing}</p>
                        <p><strong>Tarea Diaria (Tip):</strong> ${tip}</p>
                    `;
                });
            } else {
                console.error("Elemento analysisForm no encontrado.");
            }

            // Cargar análisis por deportista
            function loadAnalyses() {
                console.log("Cargando análisis de deportista");
                const athleteId = document.getElementById("viewAthlete").value;
                const tableBody = document.getElementById("analysesTable")?.querySelector("tbody");
                const table = document.getElementById("analysesTable");
                if (!tableBody || !table) {
                    console.error("Tabla de análisis no encontrada");
                    return;
                }
                table.classList.add("hidden");
                tableBody.innerHTML = "";
                if (athleteId) {
                    const athletes = getAthletes();
                    const athlete = athletes.find(a => a.id === athleteId);
                    if (athlete && athlete.analyses.length > 0) {
                        athlete.analyses.forEach(analysis => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${analysis.objeto}</td>
                                <td>${analysis.estado}${analysis.notas ? ` (${analysis.notas})` : ""}</td>
                                <td>${analysis.color}</td>
                                <td>${analysis.textura}</td>
                                <td>${analysis.tamaño}</td>
                                <td>${analysis.simbolismo.substring(0, 50)}...</td>
                                <td>${analysis.trauma.substring(0, 50)}...</td>
                                <td>${new Date(analysis.fecha).toLocaleDateString()}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                        table.classList.remove("hidden");
                    } else {
                        console.error("No hay análisis para deportista ID", athleteId);
                        alert("No hay análisis para este deportista.");
                    }
                }
            }

            // Exportar a CSV
            function exportData() {
                console.log("Exportando datos a CSV");
                const athletes = getAthletes();
                let csv = "ID,Nombre,Apellidos,Telefono,Email,Deporte,Fecha Nacimiento,Hora Nacimiento,Objeto,Estado,Notas,Color,Textura,Tamaño,Simbolismo,Trauma,Preguntas,Sanacion,Tip,Fecha Análisis\n";
                athletes.forEach(athlete => {
                    if (athlete.analyses && athlete.analyses.length > 0) {
                        athlete.analyses.forEach(analysis => {
                            csv += `"${athlete.id}","${athlete.nombre}","${athlete.apellidos}","${athlete.telefono}","${athlete.mail}","${athlete.deporte}","${athlete.fecha_nacimiento}","${athlete.hora_nacimiento}","${analysis.objeto}","${analysis.estado}","${analysis.notas ? analysis.notas.replace(/"/g, '""') : ''}","${analysis.color}","${analysis.textura}","${analysis.tamaño}","${analysis.simbolismo.replace(/"/g, '""')}","${analysis.trauma.replace(/"/g, '""')}","${analysis.preguntas.replace(/"/g, '""')}","${analysis.sanacion.replace(/"/g, '""')}","${analysis.tip.replace(/"/g, '""')}","${analysis.fecha}"\n";
                        });
                    } else {
                        csv += `"${athlete.id}","${athlete.nombre}","${athlete.apellidos}","${athlete.telefono}","${athlete.mail}","${athlete.deporte}","${athlete.fecha_nacimiento}","${athlete.hora_nacimiento}","","","","","","","","","",""\n";
                    }
                });
                const blob = new Blob([csv], { type: "text/csv" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "mindsight_datos_completos.csv";
                a.click();
                alert("Datos exportados como CSV. Ábrelo en Excel para análisis.");
            }
        });
    </script>
</body>
</html>